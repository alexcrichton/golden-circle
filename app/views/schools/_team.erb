<div class="team<%= ' removable' if f.object.is_exhibition %>">
  <% team = f.object %>
  <% id = extract_team_id(f.object_name) %>
  <!--<%= '<hr/>' if team.is_exhibition %>-->
  <p>
    <%= f.label :level, 'Team level:' %>
    <% if team.is_exhibition %>
      <%= f.select :level, [Team::APPRENTICE, Team::WIZARD] %>
      <%= f.hidden_field :_delete %>
      <%= remove_link '[Remove this team]', ".team", :class => 'controls' %>
    <% else %>
      <%= team.level %>
      <%= f.hidden_field :level %>
    <% end %>
  </p>
  <% if team.is_exhibition && !team.new_record? %>
    <p><label>Team ID Number:</label> <%= team.id %></p>
  <% end %>
  <% content_for :js do %>
    $['count<%= id %>'] = <%= team.students.size %>;
  <% end %>
  <%= small_errors(team.students) %>
  <table id="students<%= id %>" class="noborder sortable">
    <caption>
      Students
      (<span id="count<%= id %>"><%= team.students.size %></span>/<%= Team::MAXSTUDENTS %>)
    </caption>
    <tr>
      <th>First Name</th>
      <th>Last Name</th>
      <th>&nbsp;</th>
    </tr>
    <% f.fields_for :students do |sf| %>
      <%= render 'student', :f => sf %>
    <% end %>
  </table>
  <%= add_link 'add',
               "#students#{id}",
               :parent => ".team",
               :var => 'student',
               :after => "changeCount('count#{id}', 1);" +
                 "$(this).parents('.team').find('tr:last').addClass($['count#{id}'] % 2 == 0 ? 'odd' : 'even')",
               :before => "if(typeof($['count#{id}']) != 'undefined' &&" +
                 "$['count#{id}'] >= #{Team::MAXSTUDENTS}) return false" %>
</div>
